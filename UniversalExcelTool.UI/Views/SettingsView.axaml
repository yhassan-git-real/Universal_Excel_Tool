<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:UniversalExcelTool.UI.ViewModels"
             mc:Ignorable="d" d:DesignWidth="950" d:DesignHeight="700"
             x:Class="UniversalExcelTool.UI.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">

    <Design.DataContext>
        <vm:SettingsViewModel/>
    </Design.DataContext>

    <ScrollViewer>
        <StackPanel Margin="12">
            <!-- Unsaved Changes Warning -->
            <Border Background="#FEF3C7" 
                    BorderBrush="#FCD34D"
                    BorderThickness="1"
                    CornerRadius="6"
                    Padding="10,8"
                    Margin="0,0,0,12"
                    IsVisible="{Binding HasUnsavedChanges}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="âš ï¸" FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock Text="You have unsaved changes. Click 'Save Changes' to apply them."
                               FontSize="11"
                               Foreground="#92400E"
                               TextWrapping="Wrap"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- First Grid: Configuration -->
            <Grid RowDefinitions="Auto,Auto,Auto" Margin="0,0,0,12">
                
                <!-- Row 0: Database Connection -->
                <Border Grid.Row="0" 
                        Background="White"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        BoxShadow="0 1 3 0 #0000001A"
                        Margin="0,0,0,8">
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <!-- Summary Info -->
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <Border Background="#EEF2FF"
                                    CornerRadius="6"
                                    Width="32"
                                    Height="32"
                                    VerticalAlignment="Center">
                                <TextBlock Text="ðŸ—„ï¸" 
                                           FontSize="16" 
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="Database Connection" 
                                           FontSize="14" 
                                           FontWeight="SemiBold"
                                           Foreground="#1A1A1A"/>
                                <TextBlock Text="{Binding DatabaseConnectionSummary, FallbackValue='Click to configure SQL Server connection'}"
                                           FontSize="11"
                                           Foreground="#6B7280"
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Status Indicator -->
                        <Border Grid.Column="1" 
                                Background="{Binding IsConnectionConfigured, Converter={StaticResource BoolToStatusColorConverter}, FallbackValue=#FEF3C7}"
                                BorderBrush="{Binding IsConnectionConfigured, Converter={StaticResource BoolToStatusBorderConverter}, FallbackValue=#FCD34D}"
                                BorderThickness="1"
                                CornerRadius="10"
                                Padding="8,2"
                                Margin="0,0,10,0"
                                VerticalAlignment="Center">
                            <TextBlock Text="{Binding ConnectionStatusText, FallbackValue='Not Configured'}"
                                       FontSize="10"
                                       FontWeight="Medium"
                                       Foreground="{Binding IsConnectionConfigured, Converter={StaticResource BoolToStatusTextConverter}, FallbackValue=#92400E}"/>
                        </Border>
                        
                        <!-- Configure Button -->
                        <Button Grid.Column="2"
                                Command="{Binding OpenDatabaseConfigCommand}"
                                Height="28"
                                Padding="12,0"
                                Background="#007991"
                                Foreground="White"
                                BorderThickness="0"
                                CornerRadius="6"
                                FontSize="11"
                                FontWeight="Medium"
                                Cursor="Hand">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="âš™ï¸" FontSize="11" VerticalAlignment="Center"/>
                                <TextBlock Text="Configure" VerticalAlignment="Center"/>
                            </StackPanel>
                            <Button.Styles>
                                <Style Selector="Button:pointerover /template/ ContentPresenter">
                                    <Setter Property="Background" Value="#78ffd6"/>
                                </Style>
                                <Style Selector="Button:pressed /template/ ContentPresenter">
                                    <Setter Property="Background" Value="#4dd0ba"/>
                                </Style>
                            </Button.Styles>
                        </Button>
                    </Grid>
                </Border>

                <!-- Row 1: Parallel Cards -->
                <Grid Grid.Row="1" ColumnDefinitions="*,12,*" Margin="0,0,0,8">
                    <!-- Left Card: Directory Paths -->
                    <Border Grid.Column="0"
                            Background="White"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="12"
                            BoxShadow="0 1 3 0 #0000001A">
                        <StackPanel Spacing="8">
                            <!-- Header -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="#FEF3C7"
                                        CornerRadius="6"
                                        Width="24"
                                        Height="24"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="ðŸ“" 
                                               FontSize="12" 
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Directory Paths" 
                                           FontSize="13" 
                                           FontWeight="SemiBold"
                                           Foreground="#1A1A1A"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Fields -->
                            <StackPanel Spacing="6">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Input Excel Directory" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding InputExcelPath}" Watermark="E:\Files" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseInputExcelPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Input CSV Directory" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding InputCsvPath}" Watermark="E:\Files\CSV" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseInputCsvPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Output Excel Directory" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding OutputCsvPath}" Watermark="E:\Files\ExcelFiles" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseOutputCsvPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Logs Directory" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding LogsPath}" Watermark="C:\Data\Logs" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseLogsPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Right Card: Module Executable Paths -->
                    <Border Grid.Column="2"
                            Background="White"
                            BorderBrush="#E5E7EB"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="12"
                            BoxShadow="0 1 3 0 #0000001A">
                        <StackPanel Spacing="8">
                            <!-- Header -->
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="#F3E8FF"
                                        CornerRadius="6"
                                        Width="24"
                                        Height="24"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="ðŸ’¾" 
                                               FontSize="12" 
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Module Executable Paths" 
                                           FontSize="13" 
                                           FontWeight="SemiBold"
                                           Foreground="#1A1A1A"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Fields -->
                            <StackPanel Spacing="6">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Dynamic Table Manager" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding DynamicTableManagerPath}" Watermark="Path to executable" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseDynamicTableManagerPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Excel Processor" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding ExcelProcessorPath}" Watermark="Path to executable" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseExcelProcessorPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Database Loader" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding DatabaseLoaderPath}" Watermark="Path to executable" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseDatabaseLoaderPathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="CSV to Database" FontSize="11" FontWeight="Medium" Foreground="#374151"/>
                                    <Grid ColumnDefinitions="*,Auto">
                                        <TextBox Grid.Column="0" Text="{Binding CsvToDatabasePath}" Watermark="Path to executable" Height="28" FontSize="11" CornerRadius="4" Padding="6,0" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Command="{Binding BrowseCsvToDatabasePathCommand}" Content="..." Height="28" Width="30" Margin="4,0,0,0" Padding="0" HorizontalContentAlignment="Center" VerticalContentAlignment="Center" Background="#F3F4F6" BorderBrush="#D1D5DB" BorderThickness="1" CornerRadius="4"/>
                                    </Grid>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Row 2: Advanced Actions & Save -->
                <Grid Grid.Row="2" ColumnDefinitions="*,Auto">
                    <!-- Advanced Actions / Warning -->
                    <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                        <Border Background="#FEE2E2" CornerRadius="4" Padding="4,2">
                            <TextBlock Text="âš ï¸" FontSize="11"/>
                        </Border>
                        <TextBlock Text="Note: Restart application to apply changes." 
                                   FontSize="11" 
                                   Foreground="#6B7280" 
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Save Button -->
                    <Button Grid.Column="1"
                            Command="{Binding SaveSettingsCommand}"
                            IsEnabled="{Binding HasUnsavedChanges}"
                            Height="28"
                            Padding="12,0"
                            Background="#10B981"
                            Foreground="White"
                            BorderThickness="0"
                            CornerRadius="6"
                            FontSize="11"
                            FontWeight="Medium"
                            Cursor="Hand">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <TextBlock Text="ðŸ’¾" FontSize="11" VerticalAlignment="Center"/>
                            <TextBlock Text="Save Changes" VerticalAlignment="Center"/>
                        </StackPanel>
                        <Button.Styles>
                            <Style Selector="Button:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="#78ffd6"/>
                            </Style>
                            <Style Selector="Button:pressed /template/ ContentPresenter">
                                <Setter Property="Background" Value="#4dd0ba"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </Grid>
            </Grid>

            <!-- Second Grid: Activity Log -->
            <Border Background="White"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="0"
                    BoxShadow="0 1 3 0 #0000001A">
                <Grid RowDefinitions="Auto,*">
                    <!-- Header -->
                    <Border Grid.Row="0" 
                            Background="#F9FAFB" 
                            BorderBrush="#E5E7EB" 
                            BorderThickness="0,0,0,1"
                            CornerRadius="8,8,0,0"
                            Padding="10,8">
                        <Grid ColumnDefinitions="Auto,*,Auto">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="ðŸ“‹" FontSize="12" VerticalAlignment="Center"/>
                                <TextBlock Text="Activity Log" 
                                           FontSize="12" 
                                           FontWeight="SemiBold" 
                                           Foreground="#1A1A1A"/>
                            </StackPanel>
                            <TextBlock Grid.Column="2" 
                                       Text="{Binding LogEntries.Count, StringFormat='{}{0} entries'}"
                                       FontSize="11"
                                       Foreground="#6B7280"/>
                        </Grid>
                    </Border>

                    <!-- Log Table -->
                    <ScrollViewer Grid.Row="1" Height="120" Padding="0">
                        <ItemsControl ItemsSource="{Binding LogEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="#F3F4F6" 
                                            BorderThickness="0,0,0,1"
                                            Padding="10,4">
                                        <Grid ColumnDefinitions="24,60,*">
                                            <!-- Icon -->
                                            <TextBlock Grid.Column="0" 
                                                       Text="{Binding Icon}" 
                                                       FontSize="12" 
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                            
                                            <!-- Timestamp -->
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"
                                                       FontSize="11"
                                                       FontFamily="Consolas"
                                                       Foreground="#6B7280"
                                                       VerticalAlignment="Center"/>
                                            
                                            <!-- Message -->
                                            <TextBlock Grid.Column="2" 
                                                       Text="{Binding Message}"
                                                       FontSize="11"
                                                       Foreground="#374151"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </StackPanel>
    </ScrollViewer>

</UserControl>


